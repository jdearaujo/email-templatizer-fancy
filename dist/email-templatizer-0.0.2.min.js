/*! Email Templatizer - v0.0.2 - 2015-01-05
 * http://istocode.github.io/
 * Copyright (c) 2015 Billy Onjea.
 * Licensed under the MIT license.
 */ !function(a,b,c){function d(b){this._tplEmail=Handlebars.templates[b.name+"-block"],this._tplForm=Handlebars.templates[b.name+"-block-form"],this.$email=a(c.createElement("div")).addClass("block"),this.$form=a('<div class="block"></div>').html(this._tplForm()),this.$title=this.$form.find(".block-title"),this._init()}function e(b){var c=this;this.options=b,this._blocks=[],this.$el=a("#"+this.options.name),this.$blocksWrapper=this.$el.find(".blocks-container"),this.$notice=this.$blocksWrapper.find(".notice"),this.$preview=this.$el.find(".preview"),this.$download=this.$el.find(".download"),this.$actionBtns=this.$el.find(".action-buttons"),this.$insertBtn=this.$el.find(".insert-block"),this.$previewModal=a("#17hats-default-modal"),this.$resultFrame=a('<iframe src="'+(f+this.options.name)+'.html" width="100%" border="0" frameborder="0"></iframe>'),this.$previewModal.find(".modal-content").append(this.$resultFrame),this.$resultFrame.load(function(){c.$iframeDocument=c.$resultFrame.contents(),c.$iframeBody=c.$iframeDocument.find("body"),c.$iframeFooter=c.$iframeBody.find("#footer"),c._init()})}var f="src/templates/",g=a(b);d.prototype={_init:function(){this._verticalTabs(),this._onBgSelect(),this._onMove()},_verticalTabs:function(){var b=this.$form.find(".vertical-tabs"),c=this.$form.find(".vertical-controls");b.find(c.find("a.active").attr("href")).show(),c.on("click","a",function(d){d.preventDefault();var e=a(this);b.find(".vertical-content").hide(),c.find("a").removeClass("active"),b.find(e.attr("href")).show(),e.addClass("active")})},_onBgSelect:function(){var b=this,c=this.$form.find('[name="style"]'),d=this.$form.find(".pseudo-radio");c.on("click",function(){var c=a(this);d.removeClass("active"),c.parents(".pseudo-radio").addClass("active"),b.$title.text(c.parent().text()+" Block")})},_onMove:function(){var b=this;this.$form.on("click",".move",function(c){var d,e,f,g,h;c.preventDefault(),b.$form.siblings(".block").length&&(d=a(this),e=b.$form.prev(".block"),f=b.$form.next(".block"),g=b.$email.prev(".block"),h=b.$email.next(".block"),d.hasClass("move-up")&&e.length&&(e.before(b.$form),g.length&&g.before(b.$email)),d.hasClass("move-down")&&f.length&&(f.after(b.$form),h.length&&h.after(b.$email)))})},render:function(b){return b||(b={},a.map(this.getFormData(),function(c){b[c.name]="style"===c.name?a.parseJSON(c.value):c.value})),this.$email.html(this._tplEmail(b)),this},getFormData:function(){return this.$form.find("form").serializeArray()},remove:function(){this.$form.remove(),this.$email.remove(),this._tplEmail=this._tplForm=null}},e.prototype={_init:function(){this._bindEvents(),this.$resultFrame.css("height",g.height()-60)},_bindEvents:function(){var b=this;this.$insertBtn.on("click",function(a){a.preventDefault(),b.addBlock(),b._toggleActionBtns()}),this.$el.on("click",".delete",function(c){c.preventDefault(),b.removeBlock(a(this).parents(".block"))}),this.$preview.add(this.$download).on("click.render",function(c){var d,e=a(this);c.preventDefault(),b.renderBlocks(),e.hasClass("preview")&&(b.$iframeBody.scrollTop(0),b.$previewModal.modal("show")),e.hasClass("download")&&(d=new Blob([(new XMLSerializer).serializeToString(b.$iframeDocument[0])],{type:"text/html;charset=utf-8"}),saveAs(d,b.options.name+".html"))})},_toggleActionBtns:function(){var a=this.$el.find(".block");this.$actionBtns.toggle(a.length>0),1===a.length&&a.find(".move").addClass("disabled"),a.length>1&&a.find(".move").removeClass("disabled"),a.length?this.$notice.hide():this.$notice.show()},addBlock:function(){var a=new d({name:this.options.name});this._blocks.push(a),this.$blocksWrapper.append(a.$form.data("instance",a))},removeBlock:function(b){if(b){var c=this,d=b.data("instance");b.removeData(),a.each(this._blocks,function(a,b){d===b&&(c._blocks.splice(a,1),b.remove(),c._toggleActionBtns())})}},result:function(a){a&&this.$iframeFooter.before(a)},_sortBlocks:function(){this._blocks.sort(function(a,b){return a.$form.index()-b.$form.index()})},renderBlocks:function(){var b=this;this._sortBlocks(),a.each(this._blocks,function(a,c){c.render(),b.result(c.$email)})}};new e({name:"17hats-default"});a("body").tooltip({selector:'[data-toggle="tooltip"]'})}(jQuery,this,this.document);